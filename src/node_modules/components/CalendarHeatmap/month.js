import React from 'react';
import moment from 'moment';

import Week from './week';

const Month = ({
  streakData,
  maxCount,
  startDate,
  color,
  size = 'default',
  tooltipText,
  dataIndex,
}) => {

  const getWeekComponents = () => {
    const monthStart = moment(startDate);
    const monthEnd = moment(monthStart).endOf('month');
    const weekStart = moment(monthStart).startOf('week');
    const weeks = [];

    if (0 === monthStart.day()) {
      weekStart.subtract(6, 'day');
    } else {
      weekStart.add(1, 'day');
    }

    do {
      weeks.push(
        <Week
          key={weekStart.format('YYYYMMDD')}
          startDate={ moment(weekStart)}
          month={monthStart}
          streakData={streakData}
          maxCount={maxCount}
          color={color}
          size={size}
          tooltipText={tooltipText}
          dataIndex={dataIndex}
        />
      );
      weekStart.add(1,'week');
    } while (weekStart.isBefore(monthEnd, 'day') || weekStart.isSame(monthEnd, 'day'));
    return weeks;
  }
  const classSize = size === 'default' ? '' : `-${size}`;

  return (
    <div className={`cal-heatmap_month${classSize}`}>
      <div>{getWeekComponents()}</div>
      <div className={`cal-heatmap_label${classSize}`}>{startDate.format('MMM')}</div>
    </div>
  );
};

export default Month;
