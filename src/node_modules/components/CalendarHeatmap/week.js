import React from 'react';
import moment from 'moment';

import Day from './day';

const Week = ({
  streakData = {},
  maxCount,
  month,
  startDate,
  color,
  tooltipText,
  dataIndex,
}) => {

  const getDayComponents = () => {
    const days = [];
    for (let i = 0; i < 7; i++) {
      let canHover = false;
      const dayDate = moment(startDate).add(i, 'days');
      const postCount = (streakData[dayDate.format('YYYY-MM-DD')] && streakData[dayDate.format('YYYY-MM-DD')][dataIndex]) || (Math.random()*maxCount | 0);
      const classNames = [];
      let level = 0;
      const interval = maxCount / 4;
      if(postCount !== 0) {
        if (postCount <= interval) {
          level = 1;
        } else if (postCount <= interval*2) {
          level = 2;
        } else if (postCount <= interval*3) {
          level = 3;
        } else {
          level = 4;
        }
      }

      if (
        dayDate.isBefore(moment(month).startOf('month')) ||
        dayDate.isAfter(moment(month).endOf('month'))
      ) {
        classNames.push('is-outside-month');
      } else if (dayDate.isAfter(moment().endOf('day'))) {
        classNames.push('is-after-today');
      } else if (level) {
        canHover = true;
        classNames.push('is-level-' + level);
      }
      classNames.push(color)
      days.push(
        <Day
          key={moment(dayDate.format('MMDD'))}
          classNames={classNames.join(' ')}
          date={dayDate.format('DD/MM/YYYY')}
          postCount={postCount}
          canHover={canHover}
          tooltipText={tooltipText}
        />
      )
    }
    return days;
  }

  return (
    <div className="cal-heatmap_week">
      {getDayComponents()}
    </div>
  );
}

export default Week;
