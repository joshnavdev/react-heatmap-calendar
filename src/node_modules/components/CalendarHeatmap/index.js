import React from 'react';
import moment from 'moment';

import Month from './month.js';
import Keys from './keys';
import Menu from './menu';

class CalendarHeatMap extends React.Component {
  state = {
    currentCalHeatmap: this.props.views[0].dataIndex,
  }
  getMonthComponents = (streakData, maxCount, color, tooltipText, dataIndex) => {
    const months = [];
    for (let i = 11; i >= 0; i--) {
      const startDate = moment().subtract(i, 'month').startOf('month');
      months.push(
        <Month
          key={startDate.format('YYYYMM')}
          startDate={startDate}
          streakData={streakData}
          maxCount={maxCount}
          color={color}
          tooltipText={tooltipText}
          dataIndex={dataIndex}
        />
      );
    }
    return months;
  }

  getCalHeatmapModifided = (dataIndex) => {
    const { views, lowerText = 'lower', fewerText = 'fewer' } = this.props;
    const currentView = views.filter(view => view.dataIndex === dataIndex)[0];
    console.log('currentVIew', currentView)
    const { streakData } = this.props;
    const { maxCount, color = 'blue', tooltipText} = currentView;
    return (
      <div>
        <div className="cal-heatmap_year">
          {this.getMonthComponents(streakData, maxCount, color, tooltipText, dataIndex)}
        </div>
        <Keys
          maxCount={maxCount}
          color={color}
          fewerText={fewerText}
          lowerText={lowerText}
        />
      </div>
    );
  };
  changeView = (nextView) => {
    this.setState({
      currentCalHeatmap: nextView,
    });
  }
  render = () => {
    const { views } = this.props;
    const { currentCalHeatmap } = this.state;
    return (
      <div className="cal-heatmap">
        <Menu onChangeView={this.changeView} views={views} />
        {this.getCalHeatmapModifided(currentCalHeatmap)}
      </div>
    );
  }
};

export default CalendarHeatMap;
